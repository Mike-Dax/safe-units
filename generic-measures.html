<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Generic Measures | Safe Units</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>body{font-family:"Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;font-size:16px;line-height:1.5}body pre, body code{font-family:'Ubuntu Mono', monospace}h1, h2, h3, h4, h5, h6{font-family:'Open Sans', sans-serif}h2, h3{margin-bottom:0.5em;margin-left:-20px;margin-top:2em}body h1{color:#6272a4;margin:0;margin-left:-20px;padding-bottom:20px;padding-top:25px}.code-block_fcjziqk{border-radius:3px}.code-block_fcjziqk.code-block_fcjziqk{padding:20px}.code-inline_fji86su{color:#6272a4;font-size:18px}.link_f5wbv6l{color:#008075;text-decoration:none}.link_f5wbv6l:hover{color:#00B3A4;text-decoration:underline}.sidebar_f17rlyb7{font-size:14px;min-width:250px;overflow:auto}.page-link_f1pangt0{align-items:center;background:#E1E8ED;color:#293742;display:flex;font-weight:bold;margin:5px 0;padding:5px 10px;text-decoration:none}.page-link_f1pangt0:hover{background:#BFCCD6}.f1xul979{color:#6272a4}.fsmhnc8{color:#293742}.f1dqd257{background:#6272a4;color:#F5F8FA}.f1dqd257:hover{background:#6272a4;color:#CED9E0}.section-link_f1jporeb{color:#293742;display:block;text-decoration:none}.section-link_f1jporeb:hover{background:#E1E8ED}.section_fhlxm4f{padding:3px 20px}.subsection_f1uja56n{color:#5C7080;padding:3px 40px}.links_f1eyijfe:last-child{margin-bottom:20px}.links_f1eyijfe:first-child{margin-top:20px}.links_fw5uhqg{height:14px;margin-right:5px;width:14px}.page_f1qoppno{display:flex;flex-direction:row;height:100vh;width:100vw}.contents_f1q05lmp{background:#EBF1F5;box-shadow:inset 15px 0 30px -30px #182026;flex:1 1 auto;overflow:auto;position:relative}.body_fc2t6wj{margin:0 25px 25px 55px;max-width:800px}@media (max-width: 700px){h2, h3,body h1{margin-left:0}.sidebar_f17rlyb7{overflow:visible}.page-link_f1pangt0{display:block}.section-link_f1jporeb{display:none}.links_f1eyijfe:last-child{margin-bottom:0}.links_f1eyijfe:first-child{margin-top:0}.page_f1qoppno{display:block;overflow:auto}.contents_f1q05lmp{box-shadow:inset 0 15px 30px -30px #182026;overflow:visible}.body_fc2t6wj{margin:0 25px 25px 25px}}.end-matter_f1davdfv{border-top:1px solid #BFCCD6;font-size:14px;margin-top:20px;padding-top:20px;text-align:center}.license_f1io6m0d{color:#738694;font-size:12px;margin-top:20px;text-shadow:0 1px 0 white}</style>
        <link rel="stylesheet" type="text/css" media="screen" href="styles/highlight.css" />
<link rel="stylesheet" type="text/css" media="screen" href="styles/normalize.css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono" rel="stylesheet">
    </head>
    <body><div class="page_f1qoppno" data-reactroot=""><div class="sidebar_f17rlyb7"><div class="links_f1eyijfe"><a class="f1xul979 page-link_f1pangt0" href="index.html">Safe Units</a></div><div class="links_f1eyijfe"><a class="fsmhnc8 page-link_f1pangt0" href="measures.html">Measures</a></div><div class="links_f1eyijfe"><a class="fsmhnc8 f1dqd257 page-link_f1pangt0" href="generic-measures.html#top">Generic Measures</a><a class="section_fhlxm4f section-link_f1jporeb" href="#example">Example</a><a class="section_fhlxm4f section-link_f1jporeb" href="#breakdown">Breakdown</a><a class="section_fhlxm4f section-link_f1jporeb" href="#usage">Usage</a><a class="section_fhlxm4f section-link_f1jporeb" href="#static-methods">Static Methods</a></div><div class="links_f1eyijfe"><a class="fsmhnc8 page-link_f1pangt0" href="defining-quantities.html">Defining Quantities</a></div><div class="links_f1eyijfe"><a class="fsmhnc8 page-link_f1pangt0" href="builtin.html">Built-in Units</a></div><div class="links_f1eyijfe"><a class="fsmhnc8 page-link_f1pangt0" href="limitations.html">Limitations</a></div><div class="links_f1eyijfe"><a class="fsmhnc8 page-link_f1pangt0" href="changelog.html">Changelog</a></div><a class="f1dqd257 page-link_f1pangt0" href="https://github.com/jscheiny/safe-units"><img class="links_fw5uhqg" src="images/github-icon.png"/> View on GitHub</a></div><div class="contents_f1q05lmp"><div class="body_fc2t6wj"><div id="top"></div><h1 id="generic-measures">Generic Measures</h1><p>The default <code class="code-inline_fji86su">Measure</code> class is specifically designed around using measures where the underlying values are represented by the JavaScript <code class="code-inline_fji86su">number</code> type. However, it may be desirable to want measures where the values have different numeric types. For example, one might want measures with arbitrary precision or measures on the rational numbers. Creating such a measure class can be accomplished by using the <code class="code-inline_fji86su">createMeasureType</code> function.</p><h2 id="example">Example</h2><p>Suppose we have our own number type:</p><pre><code class="hljs typescript code-block_fcjziqk"><span class="hljs-keyword">class</span> WrappedNumber {
    <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> readonly value: <span class="hljs-built_in">number</span></span>) {}

    foo(): WrappedNumber { ... }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrap</span>(<span class="hljs-params">value: <span class="hljs-built_in">number</span></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WrappedNumber(value);
}
</code></pre><p>Now we<!-- -->&#x27;<!-- -->re going to create our own measure type that operates on <code class="code-inline_fji86su">WrappedNumber</code> types, let<!-- -->&#x27;<!-- -->s call it <code class="code-inline_fji86su">WrappedMeasure</code>:</p><pre><code class="hljs typescript code-block_fcjziqk"><span class="hljs-keyword">import</span> { createMeasureType, GenericMeasure, Unit } <span class="hljs-keyword">from</span> <span class="hljs-string">"safe-units"</span>;

<span class="hljs-keyword">type</span> WrappedMeasure&lt;U <span class="hljs-keyword">extends</span> Unit&gt; = GenericMeasure&lt;WrappedNumber, U&gt;;
<span class="hljs-keyword">const</span> WrappedMeasure = createMeasureType({
    one: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> wrap(<span class="hljs-number">1</span>),
    neg: <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> wrap(-x),
    add: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> wrap(x.value + y.value),
    sub: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> wrap(x.value - y.value),
    mult: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> wrap(x.value * y.value),
    div: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> wrap(x.value / y.value),
    pow: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> wrap(x.value ** y),
    compare: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> x - y,
    format: <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${x}</span>`</span>,
});
</code></pre><p>We can then use this class just as we would use <code class="code-inline_fji86su">Measure</code>, except anywhere we<!-- -->&#x27;<!-- -->d expect a <code class="code-inline_fji86su">number</code> we now expect a <code class="code-inline_fji86su">WrappedNumber</code>.</p><h2 id="breakdown">Breakdown</h2><p>Let<!-- -->&#x27;<!-- -->s deconstruct this example to explain what<!-- -->&#x27;<!-- -->s going on. First we start with this type definition:</p><pre><code class="hljs typescript code-block_fcjziqk"><span class="hljs-keyword">type</span> WrappedMeasure&lt;U <span class="hljs-keyword">extends</span> Unit&gt; = GenericMeasure&lt;WrappedNumber, U&gt;;
</code></pre><p>This line isn<!-- -->&#x27;<!-- -->t strictly necessary, but it is often useful to have our <code class="code-inline_fji86su">WrappedMeasure</code> available as a type. The next line <code class="code-inline_fji86su">const WrappedMeasure = ...</code> creates a value for wrapped measures. Having a type for the measure is useful for writing generic functions on wrapped measures. All this line does is bind the numeric type of <code class="code-inline_fji86su">GenericMeasure</code>. Similarly, the <code class="code-inline_fji86su">Measure</code> type has the following definition:</p><pre><code class="hljs typescript code-block_fcjziqk"><span class="hljs-keyword">type</span> Measure&lt;U <span class="hljs-keyword">extends</span> Unit&gt; = GenericMeasure&lt;<span class="hljs-built_in">number</span>, U&gt;;
</code></pre><p>After we<!-- -->&#x27;<!-- -->ve defined the type of <code class="code-inline_fji86su">WrappedMeasure</code> we now define the class itself by calling <code class="code-inline_fji86su">createMeasureType</code>. This function takes an object which let<!-- -->&#x27;<!-- -->s the generic measure type know how to perform operations on our numeric type. Note that for this simple example, we generally just unwrap the value, perform the arithmetic operation and then wrap it back up. Most of these operations should be self-explanatory, however some require some further explanation:</p><ul><li><code class="code-inline_fji86su">one</code>: A function with no arguments that simply returns the 1 value or multiplicative identity of your number system. This is used to construct base units whose values are implicitly one.</li><li><code class="code-inline_fji86su">pow</code>: This function is slightly different from the rest of the arithmetic operations in that it doesn<!-- -->&#x27;<!-- -->t take to values of type <code class="code-inline_fji86su">N</code>, instead its signature is: <code class="code-inline_fji86su">pow: (base: N, power: number) =&gt; N</code>. The <code class="code-inline_fji86su">power</code> argument is a JavaScript <code class="code-inline_fji86su">number</code> but will only ever be an integer between -5 and 5, inclusive. This is due to the computational limitations of the library that we need to be specific in the kinds of exponents we can handle.</li><li><code class="code-inline_fji86su">compare</code>: A function that returns a negative <code class="code-inline_fji86su">number</code> if its first argument is less than its second, a positive <code class="code-inline_fji86su">number</code> if its first argument is greater than its second, and <code class="code-inline_fji86su">0</code> if the arguments are equal.</li></ul><h2 id="usage">Usage</h2><p>The returned <code class="code-inline_fji86su">WrappedMeasure</code> now behaves just like <code class="code-inline_fji86su">Measure</code> does except in the domain of wrapped numbers. This means we can call <code class="code-inline_fji86su">WrappedMeasure.dimension</code> or <code class="code-inline_fji86su">WrappedMeasure.of</code> just as expected. It<!-- -->&#x27;<!-- -->s important to note that the provided quantities and units (<code class="code-inline_fji86su">Length</code>, <code class="code-inline_fji86su">Time</code>, <code class="code-inline_fji86su">meters</code>, <code class="code-inline_fji86su">seconds</code>, etc) will need to be redefined for other measure types as these types are all specific to <code class="code-inline_fji86su">number</code>.</p><h2 id="static-methods">Static Methods</h2><p>By default, generic measures come with a set of static methods that can be applied to measures of all numeric types. However, certain static methods may only make sense for a given numeric type. For example the <code class="code-inline_fji86su">Measure.trunc</code> method exists because <code class="code-inline_fji86su">Math.trunc</code> applies to <code class="code-inline_fji86su">number</code> types. To add static methods to a generic measure type, simple pass an object as a second argument to <code class="code-inline_fji86su">createMeasureType</code>:</p><pre><code class="hljs typescript code-block_fcjziqk"><span class="hljs-keyword">declare</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">value: WrappedNumber</span>): <span class="hljs-title">WrappedNumber</span></span>;
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> mass: WrappedMeasure&lt;{ mass: <span class="hljs-string">"1"</span> }&gt;;

<span class="hljs-keyword">const</span> WrappedMeasure = createMeasureType({ ... }, {
    foo: wrapUnaryFn(foo),
});

WrappedMeasure.foo(mass);
</code></pre><div class="end-matter_f1davdfv"><a class="link_f5wbv6l" href="https://github.com/jscheiny/safe-units">Safe Units</a> is developed by Jonah Scheinerman. Please <a class="link_f5wbv6l" href="mailto:jonah@scheinerman.net">contact me</a> if you have questions or concerns.<div class="license_f1io6m0d">Safe Units is distributed under the<!-- --> <a class="link_f5wbv6l" href="https://opensource.org/licenses/MIT">MIT open source license</a>.<br/><br/>Copyright © <!-- -->2020<!-- --> by Jonah Scheinerman</div></div></div></div></div></body>
</html>